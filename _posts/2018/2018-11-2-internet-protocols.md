---
layout: post
title: 互联网协议
category: other
tags: [other]
---

随着互联网越来越普及，数据通过互联网的传播越来越频繁，极大的改变了我们的工作和生活，那数据到底是怎么在互联网中进行传播的呢？下面就从几个方面来进行阐述。

## 一、概述

## 分层模型  

计算机网络中有七层网络模型和四层网络模型，其实分几层及每层名字并不重要，重要的是为什么分层及每层的功能。下面以五层模型进行说明。

![互联网五层模型](https://louisjiang1989.github.io/assets/images/2018/internet-model.JPG)

从上面的图可以看出，如果从深圳的一个主机发送数据到洛杉矶的一个主机上，其数据流如上图所示，其实深圳主机并不知道洛杉矶主机在哪里，那数据到底是怎么成功发送的呢？其实互联网可以分成多层，每层都有多种协议，这些协议一起组成了互联网协议，就跟一栋房子一样，上层依赖下层，下层为上层提供需要的功能，下面我们从下层依次向上进行分析，即从物理层Physic Layer -> 数据链路层Link Layer -> 网络层Network Layer -> 传输层Transport Layer -> 应用层Application Layer 。

## 二、物理层

电脑要组网，首先第一件事就是需要通过电缆、双绞线、光缆等方式进行连接。这就是物理层的功能，主要是把电脑连接起来的物理手段，规定了一些物理特性，负责传输0和1电信号。

## 三、数据链路层

# 3.1 定义

单独0和1没有任何意义，必须规定解读方式：多少个电信号为一组？每个信号位有何意义？
这就是数据链路层的功能，位于物理层的上方，确定0和1的分组方式。

# 3.2 以太网

本来有很多协议来对0和1进行分组，但后面以太网协议占据主导，其定义了电信号0和1的分组方式，每组数据包成为帧（frame），以太网帧分为标头（Head）和数据（Data）两部分，其中标头为**18**字节，数据最小为**46**字节，最大为**1500**字节。因此一帧最小为**64**字节，最大为**1518**字节，如果数据很大，则需要分多帧进行发送。

![数据帧](https://louisjiang1989.github.io/assets/images/2018/frame.JPG)


# 3.3 MAC地址

上面提到了以太帧标头包含数据发送者和接收者的信息，那么发送者和接收者到底是怎么标识的呢？以太网规定所有接入网络的设备都必须具备“网卡”接口，数据必须从一个网卡发送到另一个网卡，网卡的地址就是发送者和接收者的地址，也称作MAC地址。

![网卡](https://louisjiang1989.github.io/assets/images/2018/netinterface.JPG)

每个网卡生产商，在出产的时候就已经将全球唯一的MAC地址写入网卡中，MAC地址总共为**48**位，一般用**12**位十六进制数表示。前六位为厂商编号，后六位为该厂商网卡流水号。

![MAC地址](https://louisjiang1989.github.io/assets/images/2018/MAC.JPG)

# 3.4 广播

发送者是怎么知道接收者网卡的MAC地址的呢？其实发送者不知道，发送者在一个子内网将数据进行广播，子网内网卡对广播的数据进行解析，MAC地址与目标MAC地址相等的则进行处理，不相等则丢弃。可以发现，这样会有一个重大缺陷，就是数据重复发送，效率很低，后面交换机可以解决这个问题。

![以太帧发送](https://louisjiang1989.github.io/assets/images/2018/frame-send.JPG)

至此，有了数据包的定义，网卡的MAC地址，广播的发送发送方式数据链路层就可以在多台计算机之间实现数据的网络传输了。

## 四、网络层

# 4.1 网络层的由来

从理论上来讲，从深圳发送数据到洛杉矶，依靠物理层和数据链路层，通过MAC地址和广播的方式可以实现，但是这样有个致命的问题，就是深圳和洛杉矶要在一个子网中，这样大的一个子网数据以广播的方式发送必然造成数据风暴，传输效率极低，因此需要将整个互联网划分位多个子网，每个子网以广播的方式发送数据。这样网络层就应运而生了。

![子网](https://louisjiang1989.github.io/assets/images/2018/subnet.JPG)

# 4.2 IP协议

网络层定义了用来子网和主机逻辑地址的协议叫IP协议，逻辑地址也称为IP地址，用一组32位的二进制来表示网络地址，一般用十进制来表示，如 192.168.3.101；IP地址由网络号和主机号组成，网络号的位数由子网掩码来确定，子网掩码的网络位全为1，其他全为0，如一个子网有24位网络位，则子网掩码为255.255.255.0，两台主机就可以通过IP地址和各自的子网掩码来确定是不是位于同一子网，判定方法就是** IP1 & NETMASK1 == IP2 && NETMASK2 ? yes : no **。

总之，IP协议有两个作用：（1）为每一天计算机分配IP地址 （2）判定那些计算机在同一子网

# 4.3 IP数据包

跟数据链路层一样，IP数据包含在以太帧的数据部分中，IP数据包也分为标头(HEAD)和数据，标头为**20-60**字节，包含版本、长度、IP地址等信息，一个IP数据包的总长度最大为**65535**，理论上IP数据包的长度则最大为**65515**，前面知道以太网帧的数据部分最大长度为**1500**，因此当IP数据包超过了**1500**字节就需要拆分成多个以太网帧进行发送。

![IP数据包](https://louisjiang1989.github.io/assets/images/2018/IP.JPG)

# 4.4 ARP协议

在数据发送中，发送者只知道对方的IP地址，并不知道接收方的MAC地址，而在一个子网中数据的发送是通过MAC地址来表示接收者的网卡地址的，因此需要一种机制来获取指定IP地址主机的MAC地址，这个机制就是ARP协议。发送方通过在子网中广播一个数据包，这个数据包的目的MAC地址填的是FF:FF:FF:FF:FF:FF，代表广播地址，这个包含在以太网帧中进行广播，子网中的主机收到这个数据包之后就会比较自己的IP地址和数据包中的目的IP地址，相等则将自己的MAC地址填充并将数据包发回，否则丢弃该数据包。

注意，在同一子网可以直接通过ARP协议获取目的MAC地址，不同子网则获取不到；不同子网的数据传输则需要发送方先将数据包发送至网关(gateway)处理，由网关根据路由表发送至下一跳，直至到达目的子网，再使用ARP协议广播，获取目的MAC地址，进而进行数据包发送和接受。

总之，通过ARP协议可以获取同一子网内的MAC地址，可以将数据发送至任意一台知道MAC地址的主机。



